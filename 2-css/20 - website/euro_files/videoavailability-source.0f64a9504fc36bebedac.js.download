(window.d3WebpackJsonp=window.d3WebpackJsonp||[]).push([[116],{483:function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return M}));var i=n(88),s=n.n(i),a=n(89),l=n.n(a),o=n(59),r=n.n(o),c=n(60),u=n.n(c),h=n(61),v=n.n(h),d=n(38),f=n.n(d),p=n(385),g=n.n(p),m=n(37),y=n.n(m),I=n(738),b=n.n(I),k=n(18),A=n.n(k),_=n(39),w=n.n(_),C=n(4),U=n.n(C),j=n(110),S=n.n(j),T=n(43),x=n.n(T),E=n(11),O=n.n(E),L=n(5),V=n.n(L),D=n(8),B=n.n(D),K=n(681);function J(t,e){var n=f()(t);if(v.a){var i=v()(t);e&&(i=A()(i).call(i,(function(e){return u()(t,e).enumerable}))),n.push.apply(n,i)}return n}var M=function(){function t(e,n){var i,a;V()(this,t);this.options=function(t){for(var e=1;e<arguments.length;e++){var n,i=null!=arguments[e]?arguments[e]:{};if(e%2)U()(n=J(Object(i),!0)).call(n,(function(e){O()(t,e,i[e])}));else if(r.a)l()(t,r()(i));else{var a;U()(a=J(Object(i))).call(a,(function(e){s()(t,e,u()(i,e))}))}}return t}({},{videoIds:[],selector:null},{},n),this.$dom=e,this.translations=null===(i=this.options)||void 0===i?void 0:null===(a=i.translations)||void 0===a?void 0:a.availability}return B()(t,[{key:"off",value:function(){K.a.off(this.options.videoIds,this._check,this)}},{key:"init",value:function(){var t;(this.$target=this.$dom,this.options.selector)&&(this.$target=$(this.options.selector,this.$dom),this.options.videoIds=x()(S()(t=this.$target).call(t,(function(t,e){return e.dataset.videoid}))));this.options.videoIds&&this.options.videoIds.length&&this._attach()}},{key:"_attach",value:function(){K.a.on(this.options.videoIds,this._check,this)}},{key:"_check",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(this.options.selector){var n;U()(n=this.options.videoIds).call(n,(function(n){var i,s=w()(e).call(e,(function(t){return t.mediaAssetId==="".concat(n)})),a=!("AVAILABLE"!==(null==s?void 0:s.status)),l=A()(i=t.$target).call(i,'[data-videoid="'.concat(n,'"]'));t._setCssClasses(l,a,null==s?void 0:s.availableAt)}))}else{var i,s=b()(i=this.options.videoIds).call(i,(function(t){return y()(e).call(e,(function(e){return e.mediaAssetId==="".concat(t)&&"AVAILABLE"===e.status}))})),a=g()(e,1),l=a[0],o=l||{},r=o.availableAt;this._setCssClasses(this.$dom,s,r)}}},{key:"_setCssClasses",value:function(t,e,n){t.toggleClass("video-available",e),t.toggleClass("video-not-available",!e),n&&this._setCountdown(n)}},{key:"_setCountdown",value:function(t){var e=$(".js-video-not-available",this.$dom);if(e.length){var n,i,s=moment.duration(moment(t).diff(moment(),"milliseconds",!0)),a=s.get("hours"),l=s.get("minutes"),o="";if(a>0)o=null===(n=this.translations)||void 0===n?void 0:null===(i=n.hours)||void 0===i?void 0:i.replace("{hours}",a).replace("{minutes}",l);else if(l>0){var r,c;o=null===(r=this.translations)||void 0===r?void 0:null===(c=r.minutes)||void 0===c?void 0:c.replace("{minutes}",l)}else{var u;o=null===(u=this.translations)||void 0===u?void 0:u.zero}e.text(o)}}}]),t}()},552:function(t,e,n){"use strict";var i=n(18),s=n.n(i),a=n(39),l=n.n(a),o=n(53),r=n.n(o),c=n(13),u=n.n(c),h=n(4),v=n.n(h),d=n(30),f=n.n(d),p=n(5),g=n.n(p),m=n(8),y=n.n(m),I=n(11),b=n.n(I),k=n(23),A=n(1),_=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"json";g()(this,t),b()(this,"handler",null),b()(this,"puller",null),b()(this,"eTag",""),b()(this,"dataCache",void 0),f()(n)||(n=[]),this.url=e,this.headers=n,this.interval=i,this.type=s}return y()(t,[{key:"start",value:function(){this.timeout&&clearTimeout(this.timeout),this.busy||this._puller(!1)}},{key:"_puller",value:function(){var t,e=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!A.e){var i=!A.d;n=n&&i;var s={};v()(t=this.headers).call(t,(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.key&&t.value&&(s[t.key]=t.value)})),this.eTag&&n&&(s["If-None-Match"]=this.eTag);var a={cache:i?"default":"no-cache",headers:new Headers(s)};this.busy=!0,fetch(this.url,a).then((function(t){if(200===t.status)return t.headers&&(e.eTag=t.headers.get("ETag")||""),"blob"===e.type?t.blob():"html"===e.type?t.text():t.json()})).then((function(t){e.dataCache=t||e.dataCache})).catch((function(t){var n;Object(A.f)(u()(n="url: ".concat(e.url," - error: ")).call(n,t))})).then((function(){k.a.dispatch(e.url,e.dataCache),e.interval>-1&&(e.timeout&&clearTimeout(e.timeout),e.timeout=r()((function(){return e._puller()}),e.interval)),e.busy=!1}))}}},{key:"clear",value:function(){k.a.off(this.url),this.interval=-1}}]),t}(),w=function(){function t(){g()(this,t),this.pollers=[]}return y()(t,[{key:"on",value:function(t,e,n,i,s,a){var o;k.a.on(t,i,s);var r=l()(o=this.pollers).call(o,(function(e){return e.url===t}));r||(r=new _(t,e,n,a),this.pollers.push(r)),r.start(),r.interval&&r.interval>n&&(r.interval=n)}},{key:"off",value:function(t,e,n){var i,a;if(!t)throw new Error("url must not be null");if(!e)throw new Error("handler must not be null");if(!this.pollers||!this.pollers.length)return!1;if(k.a.off(t,e,n))return!0;var o=l()(i=this.pollers).call(i,(function(e){return e.url===t}));return o&&o.clear(),this.pollers=s()(a=this.pollers).call(a,(function(e){return e.url!==t})),this.pollers.length>0}},{key:"clear",value:function(){var t;this.pollers&&(v()(t=this.pollers).call(t,(function(t){"function"==typeof t.clear&&t.clear()})),this.pollers=[])}}],[{key:"getInstance",value:function(e){var n=e.D3=e.D3||{};return n.livepolling=n.livepolling||new t,n.livepolling}}]),t}().getInstance(window);e.a=w},681:function(t,e,n){"use strict";var i=n(88),s=n.n(i),a=n(89),l=n.n(a),o=n(59),r=n.n(o),c=n(60),u=n.n(c),h=n(61),v=n.n(h),d=n(38),f=n.n(d),p=n(30),g=n.n(p),m=n(4),y=n.n(m),I=n(24),b=n.n(I),k=n(18),A=n.n(k),_=n(95),w=n.n(_),C=n(37),U=n.n(C),j=n(110),S=n.n(j),$=n(13),T=n.n($),x=n(116),E=n.n(x),O=n(28),L=n.n(O),V=n(5),D=n.n(V),B=n(8),K=n.n(B),J=n(11),M=n.n(J),W=n(358),z=n.n(W),H=n(63),N=n(552),q=n(1);function F(t,e){var n=f()(t);if(v.a){var i=v()(t);e&&(i=A()(i).call(i,(function(e){return u()(t,e).enumerable}))),n.push.apply(n,i)}return n}var G=function(){function t(e){var n=this;D()(this,t),M()(this,"listeners",[]),M()(this,"videoIds",[]),M()(this,"videosCache",[]),M()(this,"_attach",Object(H.a)((function(){n.savedUrl!==n.getUrlfromIds()&&(n.savedUrl&&N.a.off(n.savedUrl,n._dispatch,n),n.savedUrl=n.getUrlfromIds()),N.a.on(n.savedUrl,[{key:"x-api-key",value:n.options.apiKey}],n.options.interval,n._dispatch,n)}),250,!1,this));var i={baseUrl:e.masApiUrl,apiKey:e.apiKey};this.options=function(t){for(var e=1;e<arguments.length;e++){var n,i=null!=arguments[e]?arguments[e]:{};if(e%2)y()(n=F(Object(i),!0)).call(n,(function(e){M()(t,e,i[e])}));else if(r.a)l()(t,r()(i));else{var a;y()(a=F(Object(i))).call(a,(function(e){s()(t,e,u()(i,e))}))}}return t}({},{baseUrl:"",interval:3e4},{},i)}return K()(t,[{key:"_mergeVideoIds",value:function(t){var e;this.videoIds=L()(new E.a(T()(e=[]).call(e,L()(this.videoIds),L()(t))))}},{key:"on",value:function(t,e){var n,i,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;if(this.isActive){t=this._toStringArray(t),this._mergeVideoIds(t);var a={videoIds:t,callback:e,context:s};U()(n=this.listeners).call(n,(function(n){return z()(n.videoIds,t)&&n.callback.toString()===e.toString()&&s&&w()(n.context,s)}))||this.listeners.push(a);var l=A()(i=this.videosCache).call(i,(function(e){return b()(t).call(t,e.mediaAssetId)}));l.length&&e.call(s,l),this._attach()}else{var o=S()(t).call(t,(function(t){return{mediaAssetId:"".concat(t),status:"AVAILABLE"}}));e&&e.call(s,o)}}},{key:"off",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;e=this._toStringArray(e),this.listeners=A()(t=this.listeners).call(t,(function(t){return!z()(t.videoIds,e)||n&&!t.callback.toString()===n.toString()||i&&!w()(t.context,i)})),this.listeners.length||(this.savedUrl&&N.a.off(this.savedUrl,this._dispatch,this),this.timeout&&clearInterval(this.timeout))}},{key:"getUrlfromIds",value:function(){var t;return T()(t="".concat(this.options.baseUrl||"","v1/access-rights?mediaAssetIds=")).call(t,this.videoIds.join(","))}},{key:"_dispatch",value:function(t){var e;this.videosCache=t||[],y()(e=this.listeners).call(e,(function(e){var n=t?A()(t).call(t,(function(t){var n;return b()(n=e.videoIds).call(n,t.mediaAssetId)})):[];try{e.callback.call(e.context,n)}catch(t){Object(q.f)(t,e,n)}}))}},{key:"_toStringArray",value:function(t){if(!g()(t))throw new Error("videoIds MUST be an Array!!");return S()(t).call(t,(function(t){return"".concat(t)}))}},{key:"isActive",get:function(){return!!this.options.baseUrl&&!q.d}}],[{key:"getInstance",value:function(e){var n=e.D3=e.D3||{};return n.mediaAssetService=n.mediaAssetService||new t(e),n.mediaAssetService}}]),t}();e.a=G.getInstance(window)}}]);
//# sourceMappingURL=videoavailability-source.0f64a9504fc36bebedac.js.map